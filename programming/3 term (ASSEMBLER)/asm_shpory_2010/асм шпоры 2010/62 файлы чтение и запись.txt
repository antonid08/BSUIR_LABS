62. Операции с файлами: чтение и запись данных.

BIOS использует функцию 2 прерывания 13H для чтения секторов и функцию 3 прерывания 13H для записи секторов.  В обоих случаях DL должен содержать номер  накопителя  от 0 до 3, где 0 = A, 1 = B и т.д.,  DH  - номер головки (стороны), 0-1.  CH  должен  содержать номер дорожки от 0 до 39, а  CL  -  номер  сектора от 0 до 8.  AL содержит число секторов, которое необходимо считать.  
Допускается сразу читать не более восьми  секторов,  что более чем достаточно для большинства целей.  ES:BX должны указывать на начало буфера в памяти, куда будут помещаться данные  или откуда они будут браться.
При возврате AL будет содержать число прочитанных или записанных секторов.  Если операция  успешна,  то флаг переноса будет равен  нулю.  Если он равен 1, то AH будет содержать байт статуса дисковой операции, описанный в [5.4.8].

;---в сегменте данных
BUFFER     DB   4000 DUP(?)  ;создаем буфер

;---читаем сектора
   MOV  AX,SEG BUFFER       ;ES:BX должны указывать на буфер
   MOV  ES,AX               ;
   MOV  BX,OFFSET BUFFER    ;
   MOV  DL,0                ;номер накопителя
   MOV  DH,0                ;номер головки
   MOV  CH,0                ;номер дорожки
   MOV  CL,1                ;номер сектора
   MOV  AL,1                ;число секторов для чтения
   MOV  AH,2                ;номер функции чтения
   INT  13H                 ;

   Прерывания DOS 25H и 26H читают и записывают абсолютные сектора диска, соответственно. Надо поместить логический номер стартового сектора в DX, а DS:BX должны указывать на буфер. CX содержит число  секторов для чтения или записи, а AL -  номер  накопителя, где 0 = A, 1 = B  и  т.д.  
Процедуры  портят  все регистры, кроме сегментных. При возврате регистр флагов остается на стеке, оставляя стек невыровненным.  Не  забудьте  вытолкнуть это значение со стека  сразу после возврата (в примере это значение выталкивается в CX).

;---в сегменте данных
BUFFER      DB  DUP 5000(?)   ;создаем буфер

;---читаем сектора
   PUSH DS                 ;сохраняем регистры
   MOV  AX,SEG BUFFER      S:BX должны указывать на буфер
   MOV  DS,AX              ;
   MOV  BX,OFFSET BUFFER   ;
   MOV  DX,63              ;логический номер сектора
   MOV  CX,9               ;читаем всю дорожку
   MOV  AL,0               ;накопитель A
   INT  25H                ;функция чтения секторов
   POP  CX                 ;выталкиваем со стека флаги
   POP  DS                 ;восстанавливаем регистры
   JNC  NO_ERROR           ;если нет ошибки, то на продолжение
   CMP  AH,3               ;проверка возможных ошибок
    .
    .
NO_ERROR:                  ;продолжение программы

   Если при возврате флаг переноса равен 1, то произошла ошибка и в этом случае AH и AL содержат два отдельных байта статуса  ошибки. Если AH = 4, то указанный сектор не найден, а если AH = 2, то диск неверно отформатирован.  Если AH = 3, то была попытка записи на дискету, защищенную от записи. Все остальные значения AH говорят об аппаратной ошибке.